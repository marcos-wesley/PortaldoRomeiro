<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Servicos - Admin Portal do Romeiro</title>
  <style>
    :root {
      --primary: #b22226;
      --primary-dark: #8b1a1d;
      --sidebar-bg: #1a1a2e;
      --text-light: #e5e7eb;
      --text-muted: #9ca3af;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f8f9fa;
      min-height: 100vh;
      display: flex;
    }
    .sidebar {
      width: 260px;
      background: var(--sidebar-bg);
      color: var(--text-light);
      position: fixed;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .sidebar-header {
      padding: 24px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      flex-shrink: 0;
    }
    .sidebar-header h1 {
      font-size: 18px;
      font-weight: 700;
      color: var(--primary);
    }
    .sidebar-header p {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 4px;
    }
    .sidebar nav {
      flex: 1;
      overflow-y: auto;
      padding: 16px 0;
    }
    .nav-section {
      padding: 0 16px;
      margin-bottom: 16px;
    }
    .nav-section-title {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      color: var(--text-muted);
      padding: 0 8px;
      margin-bottom: 8px;
    }
    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      color: var(--text-muted);
      text-decoration: none;
      border-radius: 8px;
      margin-bottom: 4px;
      transition: all 0.2s;
    }
    .nav-item:hover { background: #16213e; color: white; }
    .nav-item.active { background: var(--primary); color: white; }
    .sidebar-footer {
      margin-top: auto;
      padding: 16px;
      border-top: 1px solid rgba(255,255,255,0.1);
      flex-shrink: 0;
    }
    .logout-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 16px;
      color: #ef4444;
      text-decoration: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .logout-btn:hover { background: rgba(239, 68, 68, 0.1); }
    .main {
      flex: 1;
      margin-left: 260px;
      padding: 32px;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    .header h2 { font-size: 24px; color: #1f2937; }
    .header-actions { display: flex; gap: 12px; align-items: center; }
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .btn-primary { background: var(--primary); color: white; }
    .btn-primary:hover { background: var(--primary-dark); }
    .btn-secondary { background: #e5e7eb; color: #374151; }
    .btn-secondary:hover { background: #d1d5db; }
    .btn-danger { background: #ef4444; color: white; }
    .btn-danger:hover { background: #dc2626; }
    .btn-sm { padding: 6px 12px; font-size: 12px; }
    .table-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
      overflow: hidden;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 16px;
      text-align: left;
      border-bottom: 1px solid #e5e7eb;
    }
    th {
      background: #f9fafb;
      font-weight: 600;
      color: #374151;
      font-size: 12px;
      text-transform: uppercase;
    }
    td { color: #4b5563; }
    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }
    .badge-success { background: #d1fae5; color: #059669; }
    .badge-warning { background: #fef3c7; color: #d97706; }
    .badge-info { background: #dbeafe; color: #2563eb; }
    .actions { display: flex; gap: 8px; }
    .empty-state {
      text-align: center;
      padding: 64px 32px;
      color: #6b7280;
    }
    .empty-state h3 { color: #374151; margin-bottom: 8px; }
    .loading {
      text-align: center;
      padding: 48px;
      color: #6b7280;
    }
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    .modal-overlay.active { display: flex; }
    .modal {
      background: white;
      border-radius: 12px;
      padding: 24px;
      max-width: 600px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .modal-header h3 { font-size: 18px; color: #1f2937; }
    .modal-close {
      background: none;
      border: none;
      cursor: pointer;
      color: #6b7280;
      padding: 4px;
    }
    .form-group {
      margin-bottom: 16px;
    }
    .form-group label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      color: #374151;
      margin-bottom: 6px;
    }
    .form-group input, .form-group textarea, .form-group select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 14px;
    }
    .form-group textarea {
      min-height: 80px;
      resize: vertical;
      font-family: inherit;
    }
    .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(178, 34, 38, 0.1);
    }
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .checkbox-group input[type="checkbox"] {
      width: 18px;
      height: 18px;
    }
    .modal-footer {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 24px;
    }
    .alert {
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 16px;
      font-size: 14px;
    }
    .alert-success { background: #d1fae5; color: #059669; }
    .alert-error { background: #fee2e2; color: #dc2626; }
    .description-preview {
      max-width: 200px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
  </style>
</head>
<body>
  <aside class="sidebar">
    <div class="sidebar-header">
      <h1>Portal do Romeiro</h1>
      <p>Painel Administrativo</p>
    </div>
    <nav>
      <div class="nav-section">
        <div class="nav-section-title">Principal</div>
        <a href="/admin/dashboard" class="nav-item">
          <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
          Dashboard
        </a>
      </div>
      <div class="nav-section">
        <div class="nav-section-title">Conteudo</div>
        <a href="/admin/noticias" class="nav-item">
          <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"/></svg>
          Noticias
        </a>
        <a href="/admin/videos" class="nav-item">
          <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
          Videos
        </a>
        <a href="/admin/pontos-turisticos" class="nav-item">
          <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
          Pontos Turisticos
        </a>
        <a href="/admin/paginas" class="nav-item">
          <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
          Paginas Estaticas
        </a>
        <a href="/admin/telefones" class="nav-item">
          <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/></svg>
          Telefones Uteis
        </a>
        <a href="/admin/dicas" class="nav-item">
          <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
          Dicas do Romeiro
        </a>
        <a href="/admin/servicos" class="nav-item active">
          <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
          Servicos
        </a>
        <a href="/admin/empresas" class="nav-item">
          <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
          Guia Comercial
        </a>
      </div>
      <div class="nav-section">
        <div class="nav-section-title">Usuarios</div>
        <a href="/admin/usuarios" class="nav-item">
          <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
          Usuarios
        </a>
      </div>
      <div class="nav-section">
        <div class="nav-section-title">Configuracoes</div>
        <a href="/admin/configuracoes" class="nav-item">
          <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
          Configuracoes
        </a>
      </div>
    </nav>
    <div class="sidebar-footer">
      <a href="#" class="logout-btn" onclick="logout()">
        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>
        Sair
      </a>
    </div>
  </aside>

  <main class="main">
    <div class="header">
      <h2>Servicos</h2>
      <div class="header-actions">
        <button class="btn btn-primary" onclick="openModal()">
          <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
          Novo Servico
        </button>
      </div>
    </div>

    <div id="alertContainer"></div>

    <div class="table-container">
      <div id="loading" class="loading">Carregando servicos...</div>
      <table id="servicesTable" style="display: none;">
        <thead>
          <tr>
            <th>Nome</th>
            <th>Descricao</th>
            <th>Categoria</th>
            <th>Telefone</th>
            <th>Status</th>
            <th>Acoes</th>
          </tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>
      <div id="emptyState" class="empty-state" style="display: none;">
        <h3>Nenhum servico cadastrado</h3>
        <p>Clique em "Novo Servico" para adicionar o primeiro</p>
      </div>
    </div>
  </main>

  <div id="formModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3 id="modalTitle">Novo Servico</h3>
        <button class="modal-close" onclick="closeModal()">
          <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <form id="serviceForm" onsubmit="saveService(event)">
        <input type="hidden" id="serviceId">
        <div class="form-group">
          <label for="name">Nome *</label>
          <input type="text" id="name" required placeholder="Ex: Rodoviaria de Trindade">
        </div>
        <div class="form-group">
          <label for="description">Descricao</label>
          <textarea id="description" placeholder="Descreva o servico..."></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="category">Categoria</label>
            <select id="category">
              <option value="transporte">Transporte</option>
              <option value="alimentacao">Alimentacao</option>
              <option value="saude">Saude</option>
              <option value="turismo">Turismo</option>
              <option value="hospedagem">Hospedagem</option>
              <option value="comercio">Comercio</option>
              <option value="geral">Geral</option>
            </select>
          </div>
          <div class="form-group">
            <label for="phone">Telefone</label>
            <input type="text" id="phone" placeholder="Ex: (62) 3333-4444">
          </div>
        </div>
        <div class="form-group">
          <label for="address">Endereco</label>
          <input type="text" id="address" placeholder="Ex: Av. Principal, 123">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="website">Website</label>
            <input type="text" id="website" placeholder="Ex: https://www.site.com">
          </div>
          <div class="form-group">
            <label for="order">Ordem</label>
            <input type="number" id="order" value="0" min="0">
          </div>
        </div>
        <div class="form-group">
          <label for="icon">Icone (opcional)</label>
          <input type="text" id="icon" placeholder="Ex: briefcase, map-pin">
        </div>
        <div class="form-group">
          <div class="checkbox-group">
            <input type="checkbox" id="published" checked>
            <label for="published">Publicado</label>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
          <button type="submit" class="btn btn-primary">Salvar</button>
        </div>
      </form>
    </div>
  </div>

  <div id="deleteModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3>Confirmar Exclusao</h3>
        <button class="modal-close" onclick="closeDeleteModal()">
          <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <p>Tem certeza que deseja excluir este servico?</p>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeDeleteModal()">Cancelar</button>
        <button class="btn btn-danger" onclick="confirmDelete()">Excluir</button>
      </div>
    </div>
  </div>

  <script>
    let services = [];
    let deleteId = null;

    async function loadServices() {
      try {
        const response = await fetch('/admin/api/services');
        if (!response.ok) throw new Error('Erro ao carregar servicos');
        services = await response.json();
        renderTable();
      } catch (error) {
        showAlert('Erro ao carregar servicos: ' + error.message, 'error');
      }
    }

    function renderTable() {
      const loading = document.getElementById('loading');
      const table = document.getElementById('servicesTable');
      const emptyState = document.getElementById('emptyState');
      const tbody = document.getElementById('tableBody');

      loading.style.display = 'none';

      if (services.length === 0) {
        table.style.display = 'none';
        emptyState.style.display = 'block';
        return;
      }

      table.style.display = 'table';
      emptyState.style.display = 'none';

      tbody.innerHTML = services.map(service => `
        <tr>
          <td><strong>${escapeHtml(service.name)}</strong></td>
          <td class="description-preview">${escapeHtml(service.description || '-')}</td>
          <td><span class="badge badge-info">${escapeHtml(service.category || 'geral')}</span></td>
          <td>${escapeHtml(service.phone || '-')}</td>
          <td>
            <span class="badge ${service.published ? 'badge-success' : 'badge-warning'}">
              ${service.published ? 'Publicado' : 'Rascunho'}
            </span>
          </td>
          <td class="actions">
            <button class="btn btn-secondary btn-sm" onclick="editService('${service.id}')">Editar</button>
            <button class="btn btn-danger btn-sm" onclick="deleteService('${service.id}')">Excluir</button>
          </td>
        </tr>
      `).join('');
    }

    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function openModal() {
      document.getElementById('modalTitle').textContent = 'Novo Servico';
      document.getElementById('serviceForm').reset();
      document.getElementById('serviceId').value = '';
      document.getElementById('published').checked = true;
      document.getElementById('formModal').classList.add('active');
    }

    function closeModal() {
      document.getElementById('formModal').classList.remove('active');
    }

    function editService(id) {
      const service = services.find(s => s.id === id);
      if (!service) return;

      document.getElementById('modalTitle').textContent = 'Editar Servico';
      document.getElementById('serviceId').value = service.id;
      document.getElementById('name').value = service.name || '';
      document.getElementById('description').value = service.description || '';
      document.getElementById('category').value = service.category || 'geral';
      document.getElementById('phone').value = service.phone || '';
      document.getElementById('address').value = service.address || '';
      document.getElementById('website').value = service.website || '';
      document.getElementById('order').value = service.order || 0;
      document.getElementById('icon').value = service.icon || '';
      document.getElementById('published').checked = service.published !== false;
      document.getElementById('formModal').classList.add('active');
    }

    async function saveService(event) {
      event.preventDefault();
      
      const id = document.getElementById('serviceId').value;
      const data = {
        name: document.getElementById('name').value,
        description: document.getElementById('description').value || null,
        category: document.getElementById('category').value,
        phone: document.getElementById('phone').value || null,
        address: document.getElementById('address').value || null,
        website: document.getElementById('website').value || null,
        order: parseInt(document.getElementById('order').value) || 0,
        icon: document.getElementById('icon').value || null,
        published: document.getElementById('published').checked
      };

      try {
        const url = id ? `/admin/api/services/${id}` : '/admin/api/services';
        const method = id ? 'PUT' : 'POST';
        
        const response = await fetch(url, {
          method,
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        const result = await response.json();
        if (!response.ok) throw new Error(result.error || 'Erro ao salvar');

        showAlert(result.message || 'Servico salvo com sucesso!', 'success');
        closeModal();
        loadServices();
      } catch (error) {
        showAlert('Erro ao salvar: ' + error.message, 'error');
      }
    }

    function deleteService(id) {
      deleteId = id;
      document.getElementById('deleteModal').classList.add('active');
    }

    function closeDeleteModal() {
      deleteId = null;
      document.getElementById('deleteModal').classList.remove('active');
    }

    async function confirmDelete() {
      if (!deleteId) return;

      try {
        const response = await fetch(`/admin/api/services/${deleteId}`, { method: 'DELETE' });
        const result = await response.json();
        if (!response.ok) throw new Error(result.error || 'Erro ao excluir');

        showAlert(result.message || 'Servico excluido com sucesso!', 'success');
        closeDeleteModal();
        loadServices();
      } catch (error) {
        showAlert('Erro ao excluir: ' + error.message, 'error');
      }
    }

    function showAlert(message, type) {
      const container = document.getElementById('alertContainer');
      container.innerHTML = `<div class="alert alert-${type}">${escapeHtml(message)}</div>`;
      setTimeout(() => { container.innerHTML = ''; }, 5000);
    }

    async function logout() {
      try {
        await fetch('/admin/api/logout', { method: 'POST' });
        window.location.href = '/admin/login';
      } catch (error) {
        window.location.href = '/admin/login';
      }
    }

    loadServices();
  </script>
</body>
</html>
